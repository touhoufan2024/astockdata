name: Sync Main to Other Branches

on:
  push:
    branches:
      - main
  workflow_dispatch: # 允许手动触发

jobs:
  sync:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 必须获取完整历史才能进行分支同步

      - name: Config Git
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"

      - name: Sync to data branch
        run: |
          git checkout data
          # 使用 -X theirs 自动解决冲突，优先保留 main 分支的内容
          git merge main --no-edit -X theirs
          git push origin data

      - name: Sync to llm_analyze branch
        run: |
          git checkout llm_analyze
          # 同理，优先保留 main 的脚本和配置
          git merge main --no-edit -X theirs
          git push origin llm_analyze
